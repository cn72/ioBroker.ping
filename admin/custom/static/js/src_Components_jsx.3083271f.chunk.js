"use strict";(self.webpackChunkiobroker_admin_component_ping=self.webpackChunkiobroker_admin_component_ping||[]).push([["src_Components_jsx"],{66393:(W,y,h)=>{h.r(y),h.d(y,{default:()=>M});var E=h(28437),s=h.n(E),w=h(95973),d=h.n(w),a=h(67085),u=h(37449),k=h(60556),_=Object.defineProperty,I=Object.getPrototypeOf,$=Reflect.get,j=(l,t,n)=>t in l?_(l,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[t]=n,x=(l,t,n)=>j(l,typeof t!="symbol"?t+"":t,n),O=(l,t,n)=>$(I(l),n,t),S=(l,t,n)=>new Promise((i,e)=>{var r=p=>{try{c(n.next(p))}catch(m){e(m)}},o=p=>{try{c(n.throw(p))}catch(m){e(m)}},c=p=>p.done?i(p.value):Promise.resolve(p.value).then(r,o);c((n=n.apply(l,t)).next())});const P=(l,t)=>l.split(t).length-1,T=l=>(l>>>0).toString(2),N=l=>l.split(".").map(Number),D=l=>P(N(l).map(t=>T(t)).join(""),"1");function B(l){const t=l.split(".").map(i=>parseInt(i,10).toString(2));if(t.length!==4)return 0;const n=t.join("").split("1").length-1;return Math.pow(2,32-n)}class g extends k.ConfigGeneric{constructor(t){super(t),x(this,"onChangedState",(n,i)=>{if(n.endsWith(".alive")){const e=i?i.val:!1;e!==this.state.alive&&this.setState({alive:e})}else if(n.endsWith(".progress")){const e=i?i.val:0;e!==this.state.progress&&this.setState({progress:e})}else if(n.endsWith(".running")){const e=!!(i!=null&&i.val);e!==this.state.running&&this.setState({running:e})}else if(n.endsWith(".result")){const e=(i==null?void 0:i.val)||"[]";e!==JSON.stringify(this.state.ips)&&this.setState({ips:JSON.parse(e)})}else if(n.endsWith(".status")){const e=(i==null?void 0:i.val)||"";e!==this.state.status&&this.setState({status:e})}}),this.state={alive:!1,progress:0,interface:"",interfaces:[],selected:[],ips:[],running:!1,status:""}}componentDidMount(){return S(this,null,function*(){var t,n;yield O(g.prototype,this,"componentDidMount").call(this);const i={},e=yield this.props.socket.getState(`system.adapter.ping.${this.props.instance}.alive`);i.alive=!!(e!=null&&e.val);const r=yield this.props.socket.getState(`ping.${this.props.instance}.browse.progress`),o=yield this.props.socket.getState(`ping.${this.props.instance}.browse.running`),c=yield this.props.socket.getState(`ping.${this.props.instance}.browse.result`),p=yield this.props.socket.getState(`ping.${this.props.instance}.browse.status`);i.status=(p==null?void 0:p.val)||"",i.progress=(r==null?void 0:r.val)||0,i.running=!!(o!=null&&o.val);try{i.ips=JSON.parse(c==null?void 0:c.val)||[]}catch(b){i.ips=[]}yield this.props.socket.subscribeState(`system.adapter.ping.${this.props.instance}.alive`,this.onChangedState),yield this.props.socket.subscribeState(`ping.${this.props.instance}.browse.*`,this.onChangedState);const m=yield this.props.socket.getObject(`system.adapter.ping.${this.props.instance}`),f=yield this.props.socket.getObject(`system.host.${m.common.host}`);if((n=(t=f==null?void 0:f.native)==null?void 0:t.hardware)!=null&&n.networkInterfaces){const b=[];Object.keys(f.native.hardware.networkInterfaces).forEach(C=>{f.native.hardware.networkInterfaces[C].forEach(v=>{v.family==="IPv4"&&!v.internal&&b.push({name:C,ip:v.address,netmask:v.netmask})})}),this.setState({interfaces:b})}})}browse(){this.props.socket.sendTo(`ping.${this.props.instance}`,"browse",this.state.interfaces.find(t=>t.ip===this.state.interface)).then(t=>this.setState({ips:(t==null?void 0:t.result)||[]}))}componentWillUnmount(){return S(this,null,function*(){yield this.props.socket.unsubscribeState(`system.adapter.ping.${this.props.instance}.alive`,this.onChangedState),yield this.props.socket.unsubscribeState(`ping.${this.props.instance}.browse.*`,this.onChangedState)})}renderItem(){if(!this.state.interfaces)return s().createElement(a.LinearProgress,null);const t=this.props.data.devices||[],n=this.state.ips.filter(e=>!t.find(r=>r.ip===e)),i=n.length===this.state.selected.length;return s().createElement("div",{style:{width:"100%"},className:"ping_custom"},s().createElement("h4",null,u.I18n.t("custom_ping_title")),s().createElement("div",{style:{width:"100%",display:"flex",alignItems:"center"}},s().createElement(a.FormControl,{style:{width:"100%",maxWidth:600},variant:"standard"},s().createElement(a.InputLabel,null,u.I18n.t("custom_ping_interface")),s().createElement(a.Select,{variant:"standard",value:this.state.interface,onChange:e=>this.setState({interface:e.target.value})},s().createElement(a.MenuItem,{value:""},s().createElement("em",null,u.I18n.t("custom_ping_select_interface"))),this.state.interfaces.map(e=>{const r=B(e.netmask);return s().createElement(a.MenuItem,{disabled:r>4096,value:e.ip},`${e.name} - ${e.ip} (${r} ${u.I18n.t("custom_ping_ips")})`)}))),s().createElement(a.Button,{style:{marginLeft:16,whiteSpace:"nowrap"},variant:"contained",disabled:!this.state.alive||!this.state.interface,onClick:()=>{this.state.running?this.props.socket.setState(`ping.${this.props.instance}.browse.running`,!1):this.browse()}},this.state.running?s().createElement(a.CircularProgress,null):null,s().createElement("span",{style:{marginLeft:8}},this.state.running?`${this.state.status} ${u.I18n.t("custom_ping_stop")}`:u.I18n.t("custom_ping_browse")))),this.state.running?s().createElement(a.LinearProgress,{value:this.state.progress/255*100,variant:"determinate"}):s().createElement("div",{style:{height:4}}),s().createElement(a.TableContainer,{component:a.Paper,style:{width:"100%"}},s().createElement(a.Table,{style:{width:"100%"},size:"small"},s().createElement(a.TableHead,null,s().createElement(a.TableRow,{style:{background:this.props.themeType==="dark"?"#333":"#DDD"}},s().createElement(a.TableCell,{style:{height:55}},n.length?s().createElement(a.Checkbox,{title:u.I18n.t("custom_ping_select_all"),disabled:!this.state.alive||this.state.running,indeterminate:!i&&this.state.selected.length,checked:i,onClick:()=>{i?this.setState({selected:[]}):this.setState({selected:n})}}):null),s().createElement(a.TableCell,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:55}},u.I18n.t("custom_ping_ip"),s().createElement(a.Button,{variant:"contained",disabled:!this.state.selected.length,onClick:()=>{const e=[...this.props.data.devices];this.state.selected.forEach(o=>{e.find(c=>c.ip===o)||e.push({ip:o,name:o})});const r=JSON.parse(JSON.stringify(this.props.data));r.devices=e,e.sort((o,c)=>o.ip>c.ip?1:o.ip<c.ip?-1:0),this.props.onChange(r),this.setState({selected:[]})}},u.I18n.t("custom_ping_add"))))),s().createElement(a.TableBody,null,this.state.ips.map(e=>s().createElement(a.TableRow,{key:e,sx:{"&:last-child td, &:last-child th":{border:0}}},s().createElement(a.TableCell,{component:"th",scope:"row"},t.find(r=>r.ip===e)?null:s().createElement(a.Checkbox,{checked:this.state.selected.includes(e),style:{padding:"0 8px"},onChange:()=>{const r=this.state.selected,o=r.indexOf(e);o===-1?r.push(e):r.splice(o,1),this.setState({selected:r})}})),s().createElement(a.TableCell,null,e)))))))}}g.propTypes={socket:d().object.isRequired,themeType:d().string,themeName:d().string,style:d().object,data:d().object.isRequired,attr:d().string,schema:d().object,onError:d().func,onChange:d().func};const M={PingBrowseComponent:g}}}]);

//# sourceMappingURL=src_Components_jsx.3083271f.chunk.js.map